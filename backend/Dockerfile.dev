# Development Dockerfile for Backend
# Enables hot reload with tsx watch
ARG NODE_VERSION=20
FROM node:${NODE_VERSION}-alpine

WORKDIR /app

# Install dependencies:
# - python3/make/g++: native module compilation
# - ffmpeg: video processing (compression, thumbnail extraction)
# - vips-dev: image processing (sharp uses libvips)
# - libheif-dev: HEIC/HEIF image support for sharp
# - curl: health checks
RUN apk add --no-cache python3 make g++ ffmpeg vips-dev libheif-dev curl

# Copy package files
COPY package*.json ./

# Install ALL dependencies (including dev dependencies)
RUN npm ci

# Copy source code (will be overridden by volume mount)
COPY . .

# Expose application port and debugger port
EXPOSE 3001 9229

# Development server with hot reload and debugging enabled
CMD ["npm", "run", "dev", "--", "--inspect=0.0.0.0:9229"]
