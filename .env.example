# Sim RQ Environment Configuration
# ====================================
# Copy to .env and fill in your values. NEVER commit .env to git!

# ==========================================
# ENVIRONMENT
# ==========================================
# Set to 'development' for local testing (non-secure cookies for HTTP)
# Set to 'production' for deployment (secure cookies, requires HTTPS)
# NODE_ENV=development

# ==========================================
# BOOTSTRAP ADMIN ACCOUNT
# ==========================================
# The qAdmin account is used for initial SSO setup. After configuring Entra ID
# and syncing Admin users, disable qAdmin via Settings > User Management.
# Default password should be changed in production.
QADMIN_PASSWORD=admin123

# ==========================================
# DEVELOPMENT TEST ACCOUNTS (optional)
# ==========================================
# These accounts are seeded in the database for development/testing only.
# Override passwords here for E2E tests if needed.
# TEST_MANAGER_PASSWORD=manager123
# TEST_ENGINEER_PASSWORD=engineer123
# TEST_USER_PASSWORD=user123

# ==========================================
# REQUIRED
# ==========================================

# Database password - generate with: openssl rand -base64 24
DB_PASSWORD=CHANGE_ME_STRONG_PASSWORD

# Entra SSO encryption key - generate with: openssl rand -base64 32
# Required to encrypt SSO client secrets in the database
ENTRA_SSO_ENCRYPTION_KEY=CHANGE_ME_USE_OPENSSL_RAND_BASE64_32

# ==========================================
# PRODUCTION SETTINGS
# ==========================================

# Your public URL (required for SSO callbacks and CORS)
# CORS_ORIGIN=https://sim-rq.yourdomain.com

# ==========================================
# SSO - MICROSOFT ENTRA ID (optional)
# ==========================================
# Configure separate Entra ID app registrations for development and production.
# Environment variables take precedence over database configuration.
# When configured via env, the Settings SSO Configuration tab is hidden.
#
# IMPORTANT: Create two separate app registrations in Azure:
# 1. Development app with redirect URI: http://localhost:5173/api/auth/sso/callback
# 2. Production app with redirect URI: https://<your-domain>/api/auth/sso/callback

# Development CORS origin (for running dev and prod side-by-side)
# DEV_CORS_ORIGIN=https://sim-rq-dev.yourdomain.com

# Development SSO (optional - for local testing)
# DEV_ENTRA_SSO_TENANT_ID=your-azure-tenant-id
# DEV_ENTRA_SSO_CLIENT_ID=your-dev-app-client-id
# DEV_ENTRA_SSO_CLIENT_SECRET=your-dev-app-client-secret
# DEV_ENTRA_SSO_REDIRECT_URI=http://localhost:5173/api/auth/sso/callback

# Production SSO (optional - for production deployment)
# ENTRA_SSO_TENANT_ID=your-azure-tenant-id
# ENTRA_SSO_CLIENT_ID=your-prod-app-client-id
# ENTRA_SSO_CLIENT_SECRET=your-prod-app-client-secret
# ENTRA_SSO_REDIRECT_URI=https://<your-domain>/api/auth/sso/callback

# ==========================================
# REDIS (optional - for multi-instance deployments)
# ==========================================
# Redis enables distributed rate limiting and WebSocket pub/sub
# across multiple backend instances. Not needed for single-instance deployments.
# Leave REDIS_HOST empty to use in-memory fallbacks.

# REDIS_HOST=redis
# REDIS_PORT=6379
# REDIS_PASSWORD=

# ==========================================
# EMAIL NOTIFICATIONS (optional)
# ==========================================
# SMTP server configuration for email notifications
# Leave credentials blank if your SMTP server doesn't require auth

# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_SECURE=false

# SMTP Authentication (optional - leave blank if not required)
# SMTP_USER=
# SMTP_PASSWORD=

# Email sender information
# SMTP_FROM_EMAIL=noreply@sim-rq.local
# SMTP_FROM_NAME=Sim RQ Notifications

# ==========================================
# FILE STORAGE (Garage S3-compatible - auto-configured)
# ==========================================
# S3-compatible storage for file attachments using Garage.
# Garage auto-initializes on first startup - no manual setup required!
#
# DEVELOPMENT: Default credentials are pre-configured in docker-compose.dev.yaml.
# File attachments work out of the box with `make dev`.
#
# PRODUCTION: Set unique credentials below. Generate with:
#   Access Key ID (GK + 24 hex chars): GK$(openssl rand -hex 12)
#   Secret Key (64 hex chars): $(openssl rand -hex 32)

# Internal endpoint (Docker service name - used by backend for uploads/deletes)
S3_ENDPOINT=http://garage:3900

# Public endpoint (browser-accessible URL for file downloads)
# Defaults to CORS_ORIGIN if not set - usually no need to configure separately
# Only set this if you need a different domain for storage (e.g., CDN)
# S3_PUBLIC_ENDPOINT=https://cdn.your-domain.com

# S3 Credentials - MUST BE CHANGED FOR PRODUCTION
# Development: Pre-configured in docker-compose.dev.yaml (no action needed for `make dev`)
# Production: Generate unique credentials with:
#   Access Key ID: GK$(openssl rand -hex 12)
#   Secret Key: $(openssl rand -hex 32)
# WARNING: Server will refuse to start in production with default dev credentials!
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=

# Bucket name (auto-created on first startup)
S3_BUCKET_NAME=sim-rq-attachments
S3_REGION=garage

# File upload limits
# MAX_FILE_SIZE_MB=3072
# ALLOWED_FILE_TYPES=pdf,doc,docx,xls,xlsx,ppt,pptx,txt,csv,png,jpg,jpeg,gif,svg,webp,heic,heif,zip,mp4,mov,avi,webm,mkv,m4v

# Garage cluster settings (production only)
# GARAGE_ZONE=dc1
# GARAGE_CAPACITY=100G

# ==========================================
# NATIVE SSL/TLS (optional - alternative to reverse proxy)
# ==========================================
# Enable native HTTPS with Let's Encrypt certificates via Cloudflare DNS-01 challenge.
# This eliminates the need for a reverse proxy (Nginx Proxy Manager, Traefik, etc.)
#
# Usage: make prod-ssl (instead of make prod)
#
# Requirements:
# - Domain managed by Cloudflare
# - Cloudflare API token with Zone:DNS:Edit permissions
#
# Create API token at: https://dash.cloudflare.com/profile/api-tokens
# Required permissions: Zone > DNS > Edit, Zone > Zone > Read

# Primary domain (becomes certificate CN - Common Name)
# SSL_DOMAIN=simrq.example.com

# Additional domains (SANs - Subject Alternative Names)
# Comma-separated list, supports wildcards
# SSL_DOMAIN_ALIASES=requests.example.com,*.internal.example.com

# Email for Let's Encrypt certificate expiry notifications
# SSL_EMAIL=admin@example.com

# Cloudflare API Token (Zone:DNS:Edit permission required)
# CLOUDFLARE_API_TOKEN=your-cloudflare-api-token

# Use Let's Encrypt staging environment for testing (default: false)
# Staging certificates are NOT trusted by browsers but avoid rate limits
# LETSENCRYPT_STAGING=false

# ------------------------------------------
# Development SSL (for side-by-side with prod)
# ------------------------------------------
# Use these when running dev and prod SSL environments simultaneously.
# Dev SSL uses ports 8443/8080 to avoid conflicting with prod (443/80).
# Usage: make dev-ssl (instead of make dev)
#
# DEV_SSL_DOMAIN=simrq-dev.example.com
# DEV_SSL_DOMAIN_ALIASES=dev.requests.example.com
